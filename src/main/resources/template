<html>
<head>
    <meta charset="utf-8">
    <meta name="testngreport" content="width=device-width, initial-scale=1.0">
    <title>Core Test Report</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/chosen/1.8.2/chosen.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="http://echarts.baidu.com/build/dist/echarts-all.js" charset="utf-8"></script>
    <script src="https://cdn.bootcss.com/chosen/1.8.2/chosen.jquery.js"></script>
    <base target="_blank">
	<style type="text/css">
	 h1, h2, h3, h4, h5, h6 {
			font-weight: 100
		}

		h1 {
			font-size: 30px
		}

		h2 {
			font-size: 24px
		}

		h3 {
			font-size: 16px
		}

		h4 {
			font-size: 14px
		}

		h5 {
			font-size: 12px
		}

		h6 {
			font-size: 10px
		}

		h3, h4, h5 {
			margin-top: 5px;
			font-weight: 600
		}

		.gray-bg {
			background-color: #f3f3f4
		}

		.white-bg {
			background-color: #fff
		}

		.dashboard-header {
			border-top: 0;
			padding: 20px
		}

		.dashboard-header h2 {
			margin-top: 10px;
			font-size: 26px
		}

		.dashboard-header .list-group-item span.label {
			margin-right: 10px
		}

		.border-bottom {
			border-bottom: 1px solid #e7eaec !important
		}

		body {
			font-family: "open sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
			font-size: 13px;
			color: #676a6c;
			overflow-x: hidden
		}

		::-webkit-scrollbar-track {
			background-color: #F5F5F5
		}

		::-webkit-scrollbar {
			width: 6px;
			background-color: #F5F5F5
		}

		::-webkit-scrollbar-thumb {
			background-color: #999
		}

		.ibox {
			clear: both;
			margin-bottom: 25px;
			margin-top: 0;
			padding: 0;
		}

		.ibox-title {
			-moz-border-bottom-colors: none;
			-moz-border-left-colors: none;
			-moz-border-right-colors: none;
			-moz-border-top-colors: none;
			background-color: #fff;
			border-color: #e7eaec;
			-webkit-border-image: none;
			-o-border-image: none;
			border-image: none;
			border-style: solid solid none;
			border-width: 4px 0 0;
			color: inherit;
			margin-bottom: 0;
			padding: 14px 15px 7px;
			min-height: 48px
		}

		.ibox-content {
			background-color: #fff;
			color: inherit;
			padding: 15px 20px 20px;
			border-color: #e7eaec;
			-webkit-border-image: none;
			-o-border-image: none;
			border-image: none;
			border-style: solid solid none;
			border-width: 1px 0
		}

		.wrapper {
			padding: 0 20px
		}

		.wrapper-content {
			padding: 20px
		}

		.chosen-container-single .chosen-single {
			background: #fff;
			box-shadow: none;
			-moz-box-sizing: border-box;
			background-color: #FFF;
			border: 1px solid #CBD5DD;
			border-radius: 2px;
			cursor: text;
			height: auto !important;
			margin: 0;
			min-height: 30px;
			overflow: hidden;
			padding: 4px 12px;
			position: relative;
			width: 100%
		}

		.chosen-container-multi .chosen-choices li.search-choice {
			background: #f1f1f1;
			border: 1px solid #ededed;
			border-radius: 2px;
			box-shadow: none;
			color: #333;
			cursor: default;
			line-height: 13px;
			margin: 3px 0 3px 5px;
			padding: 3px 20px 3px 5px;
			position: relative
		}

		.ibox-title h5 {
			display: inline-block;
			font-size: 14px;
			margin: 0 0 7px;
			padding: 0;
			text-overflow: ellipsis;
			float: left
		}

		.ibox-tools {
			display: inline-block;
			float: right;
			margin-top: 0;
			position: relative;
			padding: 0
		}

		.ibox-tools a {
			cursor: pointer;
			margin-left: 5px;
			color: #c4c4c4
		}

		.text-navy {
			color: #1ab394
		}

		.text-primary {
			color: inherit
		}

		.text-success {
			color: green
		}

		.text-info {
			color: #23c6c8
		}

		.text-warning {
			color: #f8ac59
		}

		.text-danger {
			color: #ed5565
		}

		.b-r {
			border-right: 1px solid #e7eaec
		}

		.float-e-margins .btn {
			margin-bottom: 5px
		}

		.btn-primary {
			background-color: #1ab394;
			border-color: #1ab394;
			color: #FFF
		}

		.table-bordered {
			border: 1px solid #EBEBEB
		}

		.table-bordered > thead > tr > td, .table-bordered > thead > tr > th {
			background-color: #F5F5F6
		}

		.table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {
			border: 1px solid #e7e7e7
		}

		.table > thead > tr > th {
			border-bottom: 1px solid #DDD
		}

		.table > tbody > tr > td, .table > tbody > tr > th, .table > tfoot > tr > td, .table > tfoot > tr > th, .table > thead > tr > td, .table > thead > tr > th {
			border-top: 1px solid #e7eaec;
			line-height: 1.42857;
			padding: 8px;
			vertical-align: middle
		}

		.animated.modal.fade .modal-dialog {
			-webkit-transform: none;
			-ms-transform: none;
			transform: none
		}

	</style>
</head>
<body class="gray-bg">
<div class="row  border-bottom white-bg dashboard-header">
    <div class="col-sm-12 text-center">
        <span style="color: #1ab394; font-size: 20px; font-weight: 700">Core Test Report</span>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>报告汇总</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-6 b-r" style="height:300px">
                            <form class="form-horizontal">
                                <fieldset>
                                    <legend><h5>执行时间</h5></legend>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label text-navy">运行时间:</label>
                                        <div class="col-sm-4">
                                            <span class="form-control text-navy" id="totalTime"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label text-navy">开始时间:</label>
                                        <div class="col-sm-4">
                                            <span class="form-control text-navy" id="beginTime"></span>
                                        </div>
                                        <label class="col-sm-2 control-label text-navy">结束时间:</label>
                                        <div class="col-sm-4">
                                            <span class="form-control text-navy" id="endTime"></span>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset>
                                    <legend><h5>执行结果</h5></legend>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label text-navy">用例总数:</label>
                                        <div class="col-sm-2">
                                            <span class="form-control text-navy" id="testAll"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label text-success">用例通过:</label>
                                        <div class="col-sm-2">
                                            <span class="form-control text-success" id="testPass"></span>
                                        </div>
                                        <label class="col-sm-2 control-label text-danger">用例失败:</label>
                                        <div class="col-sm-2">
                                            <span class="form-control text-danger" id="testFail"></span>
                                        </div>
                                        <label class="col-sm-2 control-label text-warning">用例跳过:</label>
                                        <div class="col-sm-2">
                                            <span class="form-control text-warning" id="testSkip"></span>
                                        </div>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                        <div class="col-sm-6">
                            <div style="height:350px" id="echarts-map-chart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>详细数据</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="close-link">
                            <i class="fa fa-times"></i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="input-group panel-heading" style="width: 100%; background-color: #1ab394; margin-bottom: 10px; text-align: left; font-family: Consolas;">
                        <label style="color: snow">测试类:</label>
                        <select class="chosen-select form-control" data-placeholder="请选择" style="width: 500px;" name="filterClass" id="filterClass">
                            <option value="">请选择</option>
                        </select>
                        <label style="color: snow; padding-left: 20px;">结果:</label>
                        <select class="chosen-select form-control" data-placeholder="请选择" style="width: 100px;" name="filterResult" id="filterResult">
                            <option value="">请选择</option>
                        </select>
                        <div style="float: right">
                            <label class="form-control">
                                <span class="text-navy">用例数: </span><span class="text-navy b-r" id="filterAll"></span><span> | </span>
                                <span style="color: green">成功: </span><span style="color: green" id="filterOk"></span><span> | </span>
                                <span class="text-danger">失败: </span><span class="text-danger" id="filterFail"></span><span> | </span>
                                <span class="text-warning">跳过: </span><span class="text-warning" id="filterSkip"></span>
                            </label>
                        </div>
                    </div>
                    <table class="table table-bordered table-hover">
                        <thead>
                        <tr class="text-navy">
                            <th>编号</th><th>用例集</th><th>用例名</th><th>测试类</th><th>测试方法</th><th>用例描述</th><th>耗时</th><th>结果</th><th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="detailBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(".collapse-link").click(function () {
        var o = $(this).closest("div.ibox"), e = $(this).find("i"), i = o.find("div.ibox-content");
	    i.slideToggle(200), e.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"), o.toggleClass("").toggleClass("border-bottom"), setTimeout(function () {
	        o.resize(), o.find("[id^=map-]").resize()
	    }, 50)
	}),
	$(".close-link").click(function () {
	    var o = $(this).closest("div.ibox");
	    o.remove()
	})
</script>
<script type="text/javascript">
    var resultData = ${resultData};
    function details(obj) {
        if ($(obj).text() == '展开') {
            var len = $(obj).parent().parent().children().length;
            var detailLog = "";
            var logs = resultData["testResult"][parseInt($(obj).attr("buttonIndex"))]["log"];
            $(obj).text("收缩");
            $(obj).removeClass("btn-primary");
            $(obj).addClass("btn-danger");
            $.each(logs, function (i, n) {
                detailLog = detailLog + "<p>" + n + "</p>";
            });
            $(obj).parent().parent().after("<tr><td colspan='" + len + "'><div style='font-family: Consolas;font-size:12px'>" + detailLog + "</div></td></tr>");
        } else if ($(obj).text() == '收缩') {
            $(obj).parent().parent().next().remove();
            $(obj).text("展开");
            $(obj).removeClass("btn-danger");
            $(obj).addClass("btn-primary");
        }

    }

    $(function () {
        $("#totalTime").text(resultData["totalTime"]);
        $("#beginTime").text(resultData["beginTime"]);
        $("#endTime").text(resultData["endTime"]);
        $("#filterAll").text(resultData["testAll"]);
        $("#testAll").text(resultData["testAll"]);
        $("#testPass").text(resultData["testPass"]);
        $("#testFail").text(resultData["testFail"]);
        $("#testSkip").text(resultData["testSkip"]);
        $("#filterOk").text(resultData["testPass"]);
        $("#filterFail").text(resultData["testFail"]);
        $("#filterSkip").text(resultData["testSkip"])
    })

    $(function () {
        var classNames = [];
        var results = [];
        $.each(resultData["testResult"], function (i, n) {
            if (classNames.indexOf(n["className"]) == -1) {
                classNames.push(n["className"]);
            }
            if (results.indexOf(n["status"]) == -1) {
                results.push(n["status"]);
            }
        });

        $.each(classNames, function (i, n) {
            $("#filterClass").append("<option value='" + n + "' hassubinfo='true'>" + n + "</option>");
        });
        $.each(results, function (i, n) {
            $("#filterResult").append("<option value='" + n + "' hassubinfo='true'>" + n + "</option>");
        });

        $("#filterClass").chosen({search_contains: true});
        $("#filterResult").chosen({search_contains: true});

        function getResults(className, caseResult) {
            $("#detailBody").children().remove();
            var filterAll = 0;
            var filterOk = 0;
            var filterFail = 0;
            var filterSkip = 0;
            $.each(resultData["testResult"], function (i, n) {
                if ((className == "" || n["className"] == className) && (caseResult == "" || n["status"] == caseResult)) {
                    filterAll += 1;
                    var status = "";
                    if (n["status"] == '成功') {
                        filterOk += 1;
                        status = "<td><span class='text-success'>成功</span></td>";
                    } else if (n["status"] == '失败') {
                        filterFail += 1;
                        status = "<td><span class='text-danger'>失败</span></td>";
                    } else if (n["status"] == '跳过') {
                        filterSkip += 1;
                        status = "<td><span class='text-warning'>跳过</span></td>";
                    } else {
                        status = "<td><span>" + n["status"] + "</span></td>";
                    }
                    var tr = "<tr style='font-family: Consolas'>" +
                        "<td>" + (i + 1) + "</td>" +
                        "<td>" + n["suiteName"] + "</td>" +
                        "<td>" + n["name"] + "</td>" +
                        "<td>" + n["className"] + "</td>" +
                        "<td>" + n["methodName"] + "</td>" +
                        "<td>" + n["description"] + "</td>" +
                        "<td>" + n["spendTime"] + "</td>" +
                        status + "<td><button type='button' onclick='details(this)' buttonIndex='" + i + "' class='btn btn-primary btn-xs' style='margin-bottom: 0px'>展开</button></td></tr>"
                    $("#detailBody").append(tr);
                }
            });
            $("#filterAll").text(filterAll);
            $("#filterOk").text(filterOk);
            $("#filterFail").text(filterFail);
            $("#filterSkip").text(filterSkip);
        }

        getResults("", "");

        $("#filterClass").on('change', function () {
            var className = $("#filterClass").val();
            var caseResult = $("#filterResult").val();
            getResults(className, caseResult);
        });

        $("#filterResult").on('change', function () {
            var className = $("#filterClass").val();
            var caseResult = $("#filterResult").val();
            getResults(className, caseResult);
        });

        function pie() {
            var option = {
                title: {
                    text: '测试用例运行结果',
                    subtext: '',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                color:['green','#ed5565','#f8ac59'],
                legend: {
                    orient: 'vertical',
                    x: 'left',
                    data: [ '成功', '失败', '跳过']
                },
                calculable : true,
                series: [
                    {
                        name: '运行结果',
                        type: 'pie',
                        radius : ['50%', '70%'],
                        itemStyle : {
                            normal : {
                                label : {
                                    show : false
                                },
                                labelLine : {
                                    show : false
                                    }
                            },
                            emphasis : {
                                label : {
                                    show : true,
                                    position : 'center',
                                    textStyle : {
                                        fontSize : '30',
                                        fontWeight : 'bold'
                                    }
                                }
                            }
                        },
                        data: [
                            {value: resultData["testPass"], name: '成功'},
                            {value: resultData["testFail"], name: '失败'},
                            {value: resultData["testSkip"], name: '跳过'}
                        ]
                    }
                ]
            };
            var chart = echarts.init(document.getElementById("echarts-map-chart"));
            chart.setOption(option);
        }
        pie();
    });
</script>
</body>
</html>